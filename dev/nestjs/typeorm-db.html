<!DOCTYPE html>
<html lang="th-TH">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ใช้ NestJS ต่อ Database อย่างไร? | Intception Hideout</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="เหมือนจะยากแต่ก็ไม่ยากอย่างที่คิด ในการต่อ Database นั้น ทางเลือกหลักๆที่เรามีก็ คือ Query เอาเอง หรือในบทความนี้ที่ผมจะมาใช้ TypeORM กันครับ">
    <meta name="image" content="https://blog.intception.me/nestjs/typeorm-db.jpg">
    <meta name="twitter:title" content="ใช้ NestJS ต่อ Database อย่างไร?">
    <meta name="twitter:description" content="เหมือนจะยากแต่ก็ไม่ยากอย่างที่คิด ในการต่อ Database นั้น ทางเลือกหลักๆที่เรามีก็ คือ Query เอาเอง หรือในบทความนี้ที่ผมจะมาใช้ TypeORM กันครับ">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://blog.intception.me/nestjs/typeorm-db.jpg">
    <meta name="twitter:url" content="https://blog.intception.me/dev/nestjs/typeorm-db.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="ใช้ NestJS ต่อ Database อย่างไร?">
    <meta property="og:description" content="เหมือนจะยากแต่ก็ไม่ยากอย่างที่คิด ในการต่อ Database นั้น ทางเลือกหลักๆที่เรามีก็ คือ Query เอาเอง หรือในบทความนี้ที่ผมจะมาใช้ TypeORM กันครับ">
    <meta property="og:image" content="https://blog.intception.me/nestjs/typeorm-db.jpg">
    <meta property="og:url" content="https://blog.intception.me/dev/nestjs/typeorm-db.html">
    <meta property="og:site_name" content="Intception Hideout">
    <meta property="article:author" content="https://www.facebook.com/100002134179036">
    <meta property="article:published_time" content="March 17, 2020 10:00:00">
    <meta property="article:tag" content="dev">
    <meta itemprop="name" content="ใช้ NestJS ต่อ Database อย่างไร?">
    <meta itemprop="description" content="เหมือนจะยากแต่ก็ไม่ยากอย่างที่คิด ในการต่อ Database นั้น ทางเลือกหลักๆที่เรามีก็ คือ Query เอาเอง หรือในบทความนี้ที่ผมจะมาใช้ TypeORM กันครับ">
    <meta itemprop="image" content="https://blog.intception.me/nestjs/typeorm-db.jpg">
    <meta property="fb:app_id" content="378991759371355">
    <meta property="article:publisher" content="https://www.facebook.com/intception">
    
    <link rel="preload" href="/assets/css/0.styles.9fcaea78.css" as="style"><link rel="preload" href="/assets/js/app.e8816fbe.js" as="script"><link rel="preload" href="/assets/js/23.98f77880.js" as="script"><link rel="preload" href="/assets/js/2.5511de28.js" as="script"><link rel="preload" href="/assets/js/7.1abc7760.js" as="script"><link rel="preload" href="/assets/js/30.ceffa3ae.js" as="script"><link rel="preload" href="/assets/js/29.6bb21054.js" as="script"><link rel="preload" href="/assets/js/41.a1cbfaa2.js" as="script"><link rel="prefetch" href="/assets/js/1.7038105b.js"><link rel="prefetch" href="/assets/js/10.93173d2d.js"><link rel="prefetch" href="/assets/js/11.0f9c5f1c.js"><link rel="prefetch" href="/assets/js/12.91b64e47.js"><link rel="prefetch" href="/assets/js/13.08a3a51f.js"><link rel="prefetch" href="/assets/js/14.c8e0a547.js"><link rel="prefetch" href="/assets/js/15.43c6b249.js"><link rel="prefetch" href="/assets/js/16.99ef011c.js"><link rel="prefetch" href="/assets/js/17.b660276a.js"><link rel="prefetch" href="/assets/js/18.7c32fc21.js"><link rel="prefetch" href="/assets/js/19.3aa4ded7.js"><link rel="prefetch" href="/assets/js/20.f9256596.js"><link rel="prefetch" href="/assets/js/21.4dd2eea6.js"><link rel="prefetch" href="/assets/js/22.bebac973.js"><link rel="prefetch" href="/assets/js/24.97336265.js"><link rel="prefetch" href="/assets/js/25.c15aed46.js"><link rel="prefetch" href="/assets/js/26.cdb80987.js"><link rel="prefetch" href="/assets/js/27.061d534a.js"><link rel="prefetch" href="/assets/js/28.a7dedf0a.js"><link rel="prefetch" href="/assets/js/31.4cee5970.js"><link rel="prefetch" href="/assets/js/32.958c025c.js"><link rel="prefetch" href="/assets/js/33.1baa13ba.js"><link rel="prefetch" href="/assets/js/34.d9701686.js"><link rel="prefetch" href="/assets/js/35.25566597.js"><link rel="prefetch" href="/assets/js/36.455eb1cd.js"><link rel="prefetch" href="/assets/js/37.f9701788.js"><link rel="prefetch" href="/assets/js/38.7adbe429.js"><link rel="prefetch" href="/assets/js/39.0e42479f.js"><link rel="prefetch" href="/assets/js/4.d70afffc.js"><link rel="prefetch" href="/assets/js/40.6427dc18.js"><link rel="prefetch" href="/assets/js/42.a1b17ae6.js"><link rel="prefetch" href="/assets/js/43.b629483d.js"><link rel="prefetch" href="/assets/js/44.3ce67008.js"><link rel="prefetch" href="/assets/js/45.58b17ad5.js"><link rel="prefetch" href="/assets/js/46.68e3b49f.js"><link rel="prefetch" href="/assets/js/47.72e2cea9.js"><link rel="prefetch" href="/assets/js/48.2928f898.js"><link rel="prefetch" href="/assets/js/49.94a83419.js"><link rel="prefetch" href="/assets/js/5.dbd44f85.js"><link rel="prefetch" href="/assets/js/6.2ecdc96d.js"><link rel="prefetch" href="/assets/js/8.47b30f38.js"><link rel="prefetch" href="/assets/js/9.3d2ae7fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9fcaea78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-v-500e1d8c><div class="theme-container" data-v-500e1d8c><header class="navbar" data-v-500e1d8c><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Intception Hideout" class="logo"> <span class="site-name can-hide">Intception Hideout</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">Dev</a></div><div class="nav-item"><a href="/lifestyle/" class="nav-link">Lifestyle</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-500e1d8c></div> <aside class="sidebar" data-v-500e1d8c><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">Dev</a></div><div class="nav-item"><a href="/lifestyle/" class="nav-link">Lifestyle</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ใช้ NestJS ต่อ Database อย่างไร?</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/nestjs/typeorm-db.html#ติดตั้ง" class="sidebar-link">ติดตั้ง</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#สร้างโปรเจค" class="sidebar-link">สร้างโปรเจค</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#ติดตั้ง-library-ที่จะใช้" class="sidebar-link">ติดตั้ง Library ที่จะใช้</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#ติดตั้งโปรแกรมอ่าน-database" class="sidebar-link">ติดตั้งโปรแกรมอ่าน Database</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#ติดตั้ง-postman" class="sidebar-link">ติดตั้ง Postman</a></li></ul></li><li><a href="/dev/nestjs/typeorm-db.html#มาเริ่มโค้ดกันเลย" class="sidebar-link">มาเริ่มโค้ดกันเลย</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#ตั้งค่า-typeorm-กันก่อน" class="sidebar-link">ตั้งค่า TypeORM กันก่อน</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#module-ใหม่" class="sidebar-link">Module ใหม่</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#สร้าง-entity" class="sidebar-link">สร้าง Entity</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#เอา-entity-ไปใช้" class="sidebar-link">เอา Entity ไปใช้</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#เขียนส่วนของ-service" class="sidebar-link">เขียนส่วนของ Service</a></li><li class="sidebar-sub-header"><a href="/dev/nestjs/typeorm-db.html#เขียน-controller" class="sidebar-link">เขียน Controller</a></li></ul></li><li><a href="/dev/nestjs/typeorm-db.html#ทดลองที่เขียน" class="sidebar-link">ทดลองที่เขียน</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page" data-v-500e1d8c> <div class="theme-default-content content__default"><h1 id="ใช้-nestjs-ต่อ-database-อย่างไร"><a href="#ใช้-nestjs-ต่อ-database-อย่างไร" class="header-anchor">#</a> ใช้ NestJS ต่อ Database อย่างไร?</h1> <span data-v-11962d9e><a href="/?tag=dev" class="tag-element" data-v-eeb2ca7e data-v-11962d9e>#Dev</a><a href="/?tag=javascript" class="tag-element" data-v-eeb2ca7e data-v-11962d9e>#Javascript</a><a href="/?tag=nestjs" class="tag-element" data-v-eeb2ca7e data-v-11962d9e>#Nestjs</a><a href="/?tag=backend" class="tag-element" data-v-eeb2ca7e data-v-11962d9e>#Backend</a><a href="/?tag=database" class="tag-element" data-v-eeb2ca7e data-v-11962d9e>#Database</a><a href="/?tag=ORM" class="tag-element" data-v-eeb2ca7e data-v-11962d9e>#ORM</a><a href="/?tag=library" class="tag-element" data-v-eeb2ca7e data-v-11962d9e>#Library</a></span> <p>เหมือนจะยากแต่ก็ไม่ยากอย่างที่คิด ในการต่อ Database นั้น ทางเลือกหลักๆที่เรามีก็ คือ Query เอาเอง หรือในบทความนี้ที่ผมจะมาใช้ TypeORM กันครับ</p> <p>เจ้าตัว TypeORM เป็น Library สำหรับทำ ORM (Object Relational Mapping) ข้อดีสั้นๆก็คือเราไม่ต้องเขียน Query เองเลย</p> <img src="/assets/img/00.9783260b.jpg" alt="Header"><p>เราสามารถ SELECT, INSERT, DELETE, UPDATE ได้โดย Map Entity (Class แสดงหน้าตาข้อมูล) กับ Database</p> <h2 id="ติดตั้ง"><a href="#ติดตั้ง" class="header-anchor">#</a> ติดตั้ง</h2> <h3 id="สร้างโปรเจค"><a href="#สร้างโปรเจค" class="header-anchor">#</a> สร้างโปรเจค</h3> <p>ผ่านคำสั่ง</p> <div class="language-sh extra-class"><pre class="language-sh"><code>nest new sample-orm
</code></pre></div><h3 id="ติดตั้ง-library-ที่จะใช้"><a href="#ติดตั้ง-library-ที่จะใช้" class="header-anchor">#</a> ติดตั้ง Library ที่จะใช้</h3> <p>หลักๆก็จะมี</p> <ul><li>@nestjs/typeorm</li> <li>typeorm</li> <li>sqlite3 (ใช้ตัวนี้เพราะขี้เกียจติดตั้ง MySQL 🤣)</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> @nestjs/typeorm typeorm sqlite3
</code></pre></div><p>ห้องต้องการต่อกับ Database ตัวอื่นก็แค่เปลี่ยน sqlite3 ซะ เช่น mysql, postgresql เป็นต้น</p> <center class="medium-zoom"><div class="force-max" style="max-width:50%;"><img src="data:image/png;base64,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" alt="Image"></div></center> <h3 id="ติดตั้งโปรแกรมอ่าน-database"><a href="#ติดตั้งโปรแกรมอ่าน-database" class="header-anchor">#</a> ติดตั้งโปรแกรมอ่าน Database</h3> <p>ในที่นี้ผมจะใช้ SQLite Studio ครับ <a href="https://github.com/pawelsalawa/sqlitestudio/releases" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
ใช้เพื่อดูฐานข้อมูล SQLite ใครมีตัวเลือกสะดวกกว่านี้ก็ใช้ได้ครับ</p> <center class="medium-zoom"><div class="force-max" style="max-width:50%;"><img src="/assets/img/02.e6f2824b.png" alt="Image"></div></center> <h3 id="ติดตั้ง-postman"><a href="#ติดตั้ง-postman" class="header-anchor">#</a> ติดตั้ง Postman</h3> <p>Postman นั้นเป็นอีกหนึ่งในโปรแกรมยอดนิยมเลยครับใช้ในการทดสอบ Request ได้อย่างง่ายๆ <a href="https://www.postman.com/downloads/" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
หากใช้ไม่เป็น อาจจะลองอ่านจาก <a href="https://medium.com/@nest12345/%E0%B8%A1%E0%B8%B2%E0%B8%97%E0%B8%94%E0%B8%AA%E0%B8%AD%E0%B8%9A-api-%E0%B8%94%E0%B9%89%E0%B8%A7%E0%B8%A2-postman-%E0%B8%81%E0%B8%B1%E0%B8%99%E0%B9%80%E0%B8%96%E0%B8%AD%E0%B8%B0-c750a09c86ce" target="_blank" rel="noopener noreferrer">ที่นี่<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <center class="medium-zoom"><div class="force-max" style="max-width:50%;"><img src="/assets/img/03.12f4f318.png" alt="Image"></div></center> <h2 id="มาเริ่มโค้ดกันเลย"><a href="#มาเริ่มโค้ดกันเลย" class="header-anchor">#</a> มาเริ่มโค้ดกันเลย</h2> <p>สิ่งที่เราจะทำหลักๆเลยมีประมาณนี้ครับ</p> <ol><li>ตั้งค่า TypeORM</li> <li>สร้าง Module ใหม่</li> <li>สร้าง Entity</li> <li>ประกอบร่าง</li> <li>ลองเขียน Service แล้วเรียกดู</li></ol> <h3 id="ตั้งค่า-typeorm-กันก่อน"><a href="#ตั้งค่า-typeorm-กันก่อน" class="header-anchor">#</a> ตั้งค่า TypeORM กันก่อน</h3> <p>ง่ายๆเลยแค่เพิ่ม TypeOrmModule เข้าไปที่<br> <code>src/app.module.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'sqlite'</span><span class="token punctuation">,</span>
      database<span class="token operator">:</span> <span class="token string">'./app.sqlite'</span><span class="token punctuation">,</span>
      entities<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      synchronize<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!=</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p>เนื่องจาก <code>app.controller.ts</code> และ <code>app.service.ts</code> ไม่ได้ใช้ ผมจึงทำการลบออกไปเลยครับ</p></div> <p>จากโค้ดด้านบนเราได้ทำการตั้งค่า TypeORM ให้เชื่อมต่อ Database SQLite โดยที่ไฟล์ Database ของเราจะเป็นไฟล์ <code>app.sqlite</code></p> <p>ในส่วนของ <strong>entities</strong> นั้น เมื่อเราสร้างเสร็จแล้วเราจะเอามาใส่ครับ</p> <p>สุดท้าย <strong>synchronize</strong> เราใส่เพื่อให้มันปรับ Table ใน Database ตาม Entity ของเรา (ด้วยความขี้เกียจ)</p> <div class="warning custom-block"><p>ข้อควรระวังในการใช้ <strong>synchronize</strong> ก็คือ อย่าใช้ใน Production หรือโค้ดบนระบบจริง อาจจะทำให้ข้อมูลเสียหายได้</p></div> <h3 id="module-ใหม่"><a href="#module-ใหม่" class="header-anchor">#</a> Module ใหม่</h3> <p>ผมจะสร้าง Module ใหม่มาจัดการข้อมูล Album ของผมกันครับ</p> <div class="language-sh extra-class"><pre class="language-sh"><code>nest g module albums
nest g controller albums
nest g <span class="token function">service</span> albums
</code></pre></div><div class="tip custom-block"><p>ไฟล์ <code>*.spec.ts</code> ลบทิ้งไปก่อนก็ได้ครับ เนื่องจากเราจะยังไม่ทำ Testing กันในบทความนี้</p></div> <h3 id="สร้าง-entity"><a href="#สร้าง-entity" class="header-anchor">#</a> สร้าง Entity</h3> <p>ทดลองสร้างแบบยังไม่ได้กำหนดว่าจะใช้กับ TypeORM จะได้แบบนี้ครับ
<code>src/albums/entity/album.entity.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Album</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  remark<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>และถ้าเราจะใช้กับ TypeORM เราก็แค่เพิ่ม</p> <div class="language-ts extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Album</span> <span class="token punctuation">{</span>
  @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  remark<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>@Entity</strong> เป็นการกำหนดว่า class นี้จะเป็น TypeORM Entity</p> <p><strong>@PrimaryGeneratedColumn</strong> กำหนดให้ Field หรือ Column นี้เป็น Primary และมี Auto Increment (ถ้าไม่กำหนดค่าตอน Insert มันจะเพิ่มค่าให้เอง)</p> <p><strong>@Column</strong> กำหนดให้เป็น Field หรือ Column ทั่วๆไป (โดยเราจะกำหนดค่า default, length, nullable ได้ด้วยถ้าต้องการ)</p> <h3 id="เอา-entity-ไปใช้"><a href="#เอา-entity-ไปใช้" class="header-anchor">#</a> เอา Entity ไปใช้</h3> <p>เมื่อเราได้ Entity มาแล้วเราจะเอากลับไปใส่ที่ <code>src/app.module.ts</code></p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AlbumsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./albums/albums.module'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Album <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./albums/entity/album.entity'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'sqlite'</span><span class="token punctuation">,</span>
      database<span class="token operator">:</span> <span class="token string">'./app.sqlite'</span><span class="token punctuation">,</span>
      entities<span class="token operator">:</span> <span class="token punctuation">[</span>Album<span class="token punctuation">]</span><span class="token punctuation">,</span>
      synchronize<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!=</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    AlbumsModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>และที่ไหนที่ต้องการใช้ Entity นี้ (ในที่นี้คือที่ AlbumModule) ก็ต้องเพิ่มตามนี้ครับ
<code>src/albums/albums.module.ts</code></p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AlbumsController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./albums.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AlbumsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./albums.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Album <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/album.entity'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>TypeOrmModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Album<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AlbumsController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AlbumsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AlbumsModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="เขียนส่วนของ-service"><a href="#เขียนส่วนของ-service" class="header-anchor">#</a> เขียนส่วนของ Service</h3> <p>ตัว TypeOrmModule จะ Inject Repository มาให้เราใช้ด้วยครับ (Repository คือตัวกลางในการติดต่อกับ Datasource ซึ่งในที่นี้ก็คือ Database ของเรา)<br>
เราสามารถทำตามนี้ได้เลย
<code>src/albums/album.service.ts</code></p> <div class="language-ts extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InjectRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Repository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Album <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/album.entity'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AlbumsService</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    @<span class="token function">InjectRepository</span><span class="token punctuation">(</span>Album<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> albumRepository<span class="token operator">:</span> Repository<span class="token operator">&lt;</span>Album<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">createOrUpdate</span><span class="token punctuation">(</span>album<span class="token operator">:</span> Album<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Album<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>album<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Album<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Album<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>DeleteResult<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumRepository<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="เขียน-controller"><a href="#เขียน-controller" class="header-anchor">#</a> เขียน Controller</h3> <p><code>src/albums/album.controller.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Controller<span class="token punctuation">,</span>
  Post<span class="token punctuation">,</span>
  Body<span class="token punctuation">,</span>
  Get<span class="token punctuation">,</span>
  Param<span class="token punctuation">,</span>
  HttpStatus<span class="token punctuation">,</span>
  HttpCode<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AlbumsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./albums.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CreateAlbumDto <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./dto/create-album.dto'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Album <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/album.entity'</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'albums'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AlbumsController</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> albumService<span class="token operator">:</span> AlbumsService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// POST /albums</span>
  @<span class="token function">HttpCode</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">createAlbum</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> newAlbum<span class="token operator">:</span> CreateAlbumDto<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Album<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> album <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Album</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    album<span class="token punctuation">.</span>title <span class="token operator">=</span> newAlbum<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
    album<span class="token punctuation">.</span>remark <span class="token operator">=</span> newAlbum<span class="token punctuation">.</span>remark<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumService<span class="token punctuation">.</span><span class="token function">createOrUpdate</span><span class="token punctuation">(</span>album<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// GET /albums</span>
  <span class="token keyword">async</span> <span class="token function">findAlbums</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Album<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span> <span class="token comment">// GET /albums/123</span>
  <span class="token keyword">async</span> <span class="token function">findAlbum</span><span class="token punctuation">(</span>@<span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Album<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Put</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span> <span class="token comment">// PUT /albums/123</span>
  <span class="token keyword">async</span> <span class="token function">updateAlbum</span><span class="token punctuation">(</span>
    @<span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    @<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createAlbumDto<span class="token operator">:</span> CreateAlbumDto<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Album<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> album <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    album<span class="token punctuation">.</span>title <span class="token operator">=</span> createAlbumDto<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
    album<span class="token punctuation">.</span>remark <span class="token operator">=</span> createAlbumDto<span class="token punctuation">.</span>remark<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumService<span class="token punctuation">.</span><span class="token function">createOrUpdate</span><span class="token punctuation">(</span>album<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Delete</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>  <span class="token comment">// DELETE /albums/123</span>
  <span class="token keyword">async</span> <span class="token function">deleteAlbum</span><span class="token punctuation">(</span>@<span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumService<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>โดย CreateAlbumDto เป็นตัวแทนข้อมูลที่รับมาจากผู้เรียกใช้งาน มีหน้าตาแบบนี้<br> <code>src/albums/dto/create-album.dto.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateAlbumDto</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  remark<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p>โค้ดเบื้องต้นไม่มีการดัก Error อะไรทั้งนั้นนะครับด้วยความขี้เกียจ</p></div> <h2 id="ทดลองที่เขียน"><a href="#ทดลองที่เขียน" class="header-anchor">#</a> ทดลองที่เขียน</h2> <p>ลองสั่งเริ่มโปรแกรมดูครับ <code>npm run start:debug</code></p> <p>เมื่อรันแล้วจะพบไฟล์ <code>app.sqlite</code> ลองเอามาเปิดดูใน SQLite Studio ก็จะพบกับตารางข้อมูล album ของเราโดยมีโครงสร้างข้อมูลแบบนี้</p> <center class="medium-zoom"><img src="/assets/img/04.5ceaa55f.png" alt="Image"></center> <p>ลองใช้ Postman ยิง Post Request เพื่อสร้าง Album ดูครับ</p> <p><code>POST localhost:3000/albums</code></p> <center class="medium-zoom"><img src="/assets/img/05.f30d141e.png" alt="Image"> <div class="caption">แค่นี้เองก็ได้ Album แล้ว</div></center> <center class="medium-zoom"><img src="/assets/img/06.331c27bd.png" alt="Image"> <div class="caption">ลองสร้างอีกอัน</div></center> <p>ถ้าจะเอาข้อมูล Album ทั้งหมดก็แค่<br> <code>GET localhost:3000/albums</code></p> <center class="medium-zoom"><img src="/assets/img/07.f77410ba.png" alt="Image"> <div class="caption">ได้ข้อมูลละ</div></center> <p>ถ้าต้องการแค่ตัวเดียวล่ะ<br> <code>GET localhost:3000/albums/1</code></p> <center class="medium-zoom"><img src="/assets/img/08.a7c59608.png" alt="Image"> <div class="caption">ก็ได้มาเหมือนกัน</div></center> <p>ลองอัปเดตข้อมูลบ้าง<br> <code>PUT localhost:3000/albums/1</code></p> <center class="medium-zoom"><img src="/assets/img/09.35f58aad.png" alt="Image"></center> <p>ลบบ้าง<br> <code>DELETE localhost:3000/albums/1</code></p> <center class="medium-zoom"><img src="/assets/img/10.ae17ced8.png" alt="Image"></center> <p>สร้างๆลบๆข้อมูลเล่น ข้อมูลเข้าจริงไหมนะ</p> <center class="medium-zoom"><img src="/assets/img/11.df9d5887.png" alt="Image"> <div class="caption">เย่ มีข้อมูลจริงๆนะ</div></center> <p>ใครมีข้อสงสัยข้อแนะนำอะไรแนะนำได้ครับ<br>
ดาวน์โหลด Source Code <a href="https://github.com/aliceblock/sample-orm.git" target="_blank" rel="noopener noreferrer">ที่นี่<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr></div> <footer class="page-edit"><!----> <div data-href="https://blog.intception.me/dev/nestjs/typeorm-db.html" data-width="100%" data-numposts="5" class="fb-comments" style="max-width:99%;"></div> <div class="last-updated"><span class="prefix">อัปเดตเมื่อ: </span> <span class="time">1 ปีที่แล้ว</span></div></footer> <!----> </main></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e8816fbe.js" defer></script><script src="/assets/js/23.98f77880.js" defer></script><script src="/assets/js/2.5511de28.js" defer></script><script src="/assets/js/7.1abc7760.js" defer></script><script src="/assets/js/30.ceffa3ae.js" defer></script><script src="/assets/js/29.6bb21054.js" defer></script><script src="/assets/js/41.a1cbfaa2.js" defer></script>
  </body>
</html>
